# 云开发 quickstart

这是云开发的快速启动指引，其中演示了如何上手使用云开发的三大基础能力：

- 数据库：一个既可在小程序前端操作，也能在云函数中读写的 JSON 文档型数据库
- 文件存储：在小程序前端直接上传/下载云端文件，在云开发控制台可视化管理
- 云函数：在云端运行的代码，微信私有协议天然鉴权，开发者只需编写业务逻辑代码

## 参考文档

- [云开发文档](https://developers.weixin.qq.com/miniprogram/dev/wxcloud/basis/getting-started.html)
### 前言
  - 首先要感谢网易云api，这个api可以在GitHub上可以找到，当然自己搭个网易云api的服务器也可以，可以参照网易云api文档上说明的做，这里我就使用别人搭好的api服务器，对接这个服务器就可以请求数据啦。
  
   - 由于个人比较喜欢听音乐，因此就选择了音乐小程序，当然这款小程序是审核不通过的，因为服务类目不符合审核条件，具体可以去微信公众平台看看类目要求，不过可以作为一个demo项目。
  
   - 问题及解决：   
其实这个问题在云开发的过程中遇到过，所以就记录一下。问题就是在搜索页面搜索歌曲时，输入中文字符串竟然没有返回结果，而英文跟数字就有，于是想了一会就是可能关于中文字符串转码问题。不过我也在小程序端试了wx.request发起请求，在输入中文试试，发现在wx.request中中文字符串有返回结果。而在云函数中定义的路由中是没有返回结果。于是为了解决调用云函数时中文字符串也能有返回结果，在定义的路由中发起请求的地址时使用encodeURI()包裹请求地址再发起请求就解决了。

页面较多，仔细写起来可能看起来比较繁琐，这里就简单介绍下，具体可以看下代码  

小程序端  

目前实现：  

###### 1.类广告页面 
（进入小程序之前有个广告效果，6秒之后就能进入主页或者点击跳过都可，利用app.json首页第一个会进入的页面实现，加个定时器就可或者点击也可以跳过）   
<img src="https://i.loli.net/2021/02/21/NKXFs9LQSguarze.png" width="100"/>  

###### 2.音乐主页面
（主页面包括搜索框【可点击进搜索页面】、轮播图、图标菜单栏、推荐歌单、音乐、mv)  
<img src="https://i.loli.net/2021/02/21/n4jXThWuKzILfpt.png" width="100"/>  <img src="https://i.loli.net/2021/02/21/SbZgeLMn1BjNDOT.png" width="100"/> 

###### 3.搜索页面
（搜索框功能实现【默认搜索关键字、搜索提示和建议（拿到搜索结果可查询相应的单曲、歌单、视频。这些都是用了组件，在其他页面也都用相应组件）】、搜索历史【利用Storage方法来对搜索框的值进行存储和读取，删除历史会提示是否确认删除，确认之后就从本地存储删除并隐藏历史栏目】、热搜）  
<img src="https://i.loli.net/2021/02/21/tCdYjLlR78UNTyX.png" width="100"/> <img src="https://i.loli.net/2021/02/21/eQE4xcqoDbLBIug.png" width="100"/>   <img src="https://i.loli.net/2021/02/21/ORWC2UX9JZaeVTN.png" width="100"/>  <img src="https://i.loli.net/2021/02/21/mCY3RsOtvSerD8L.png" width="100"/>   <img src="https://i.loli.net/2021/02/21/A34FRu6BqCYeUOH.png" width="100"/>  <img src="https://i.loli.net/2021/02/21/qlBV5WD3zujr4JM.png" width="100"/>  <img src="https://i.loli.net/2021/02/21/iuJm3MH7TZUWF26.png" width="100"/>    

###### 4.新歌页面
（新歌速递100首，点击右边视频图标可进入视频播放页面，可根据上面菜单栏切换不同语言歌单，这里切换取100条数据时比较慢，需等待一会，同时也在云开发控制台云函数设置了延长时间处理）  
<img src="https://i.loli.net/2021/02/21/Aod4sDumRT75v1Y.png" width="100"/>

###### 5.歌单页面
（直接调用云数据库里的数据进行渲染，这里后台管理系统可对歌单页面进行修改，见vue后台管理系统）  
<img src="https://i.loli.net/2021/02/21/9XxvHZIeS8MNkLa.png" width="100"/> 

###### 6.歌单详情页面
（由歌单id传递过来调用相应接口获得数据，可点击列表歌曲进入播放页面）  
<img src="https://i.loli.net/2021/02/21/LSYaEKpX4OkRho2.png" width="100"/> 

###### 7.播放页面
（歌曲id传递过来调用相应接口实现，功能实现：播放、暂停、上一首、下一首，封面切换歌词）  
<img src="https://i.loli.net/2021/02/21/bLyue6va5mfpdjq.png" width="100"/>  <img src="https://i.loli.net/2021/02/21/Rfi3c9BIme5Mzts.png" width="100"/> 

###### 8.mv页面
（调用相应接口获得所有mv，具体可以看下我的代码，获得所有mv数据之后进行分页处理，实现懒加载每次加载12条。点击mv可进入视频播放页面）  
<img src="https://i.loli.net/2021/02/21/fh1R2JlUVrbj6e5.png" width="100"/> 

###### 9.mv详情页面
（包括视频播放，视频介绍、评论区。  
【1.视频区，采用小程序原生组件video，并且实现离开当前页面有个小窗功能播放，点击又可以进入视频详情页面】  
【2.视频介绍区，点击可观看视频介绍，并可向下滚动】  
【3.评论区，点击评论图标弹出评论区，并向下滚动加载一定量的评论内容，实现懒加载效果，同时减少服务器压力，滚动到一定高度时视频就会置顶，这是利用小程序中自带的onPageScroll函数实现，然后修改相应的样式就能达到】）  
<img src="https://i.loli.net/2021/02/21/KTbac2L1YX36AUN.png" width="100"/>  <img src="https://i.loli.net/2021/02/21/Xo4wLylRexhgqHr.png" width="100"/>  <img src="https://i.loli.net/2021/02/21/6dlxBLcRjEgrZu5.png" width="100"/>  <img src="https://riyugo.com/i/2021/02/21/pit0ni.jpg" width="100"/>小窗功能

###### 10.发现页面
（即博客页面，功能包括搜索框，编辑、列表、评论、分享。  
【1.搜索框其实是一个组件，在主页面上也有，这样做便于管理且提高组件复用性，搜索框实现了模糊搜索功能，搜索一个字也能从数据库中查找并匹配相对应内容并展示出来】  
【2.编辑区，点击跳到编辑页面】  
【3.列表区，就是用户发表出来的，它可以说是一张卡片，每个卡片包含用户评论和发表内容，列表采用时间倒叙方式，最新显示在最上面，同时点击卡片可以跳到正文页面】  
【4.评论区，点击评论按钮，会提示用户授权，只有授权的用户才能登录，用户授权了才能评论，授权登录也是调用小程序方法函数，授权后出现评论区用户就进行评论了】  
【5.分享，就是一个button，添加相应属性就能实现分享功能。评论和分享也是一个组件，在正文页面中也能看到】  
<img src="https://i.loli.net/2021/02/21/Uyazl7frDQ8A6vI.png" width="100"/> <img src="https://i.loli.net/2021/02/21/GF1wOsAu2MgE5i3.png" width="100"/> <img src="https://i.loli.net/2021/02/21/wc2KQRrIknWfhle.png" width="100"/> 

###### 11.编辑页面
（实现文字发表和图片上传，图片上传则限制上传张数，最多是九张，文字也同时做了字数的限制，但超过这些限制就不能输入上传，文字输入使用了小程序原生组件textarea，能输入多行文字，图片上传功能使用了小程序带的函数，可以从官网上查到，编辑好之后就可以点击上传按钮，并把这些信息插入给数据库后返回到发现页面并展示出来）  
<img src="https://i.loli.net/2021/02/21/ricT6ASkDZJUp3G.png" width="100"/> 
###### 12.正文页面
（包括列表卡片，其实列表卡片也是一个组件，下面就是评论区的内容，内容都是存数据库在读取出来）  
<img src="https://i.loli.net/2021/02/21/hc1MbkNCwpY4rj9.png" width="100"/> 
###### 13.我的页面
（包括近期播放、我的发现、还有就是一个生成小程序码功能  
【1.近期播放，点击可以进入近期播放列表，这个列表也是组件，在歌单详情页面等歌曲列表都用了这个组件，实现思路就是利用小程序Storage方法来对播放的歌曲进行存储和获取】  
【2.我的发现，只读取当前用户自己发布的内容，其他人内容看不到，利用用户授权的信息来对数据库查找用户所有发布内容】  
【3.小程序码，根据官网例子调用相应方法函数即可】   
<img src="https://i.loli.net/2021/02/21/VXc8rgnoLEO4yfv.png" width="100"/> <img src="https://i.loli.net/2021/02/21/28iR14XgcVTLECn.png" width="100"/> <img src="https://i.loli.net/2021/02/21/lGnMuvxmhqEdgeF.png" width="100"/> <img src="https://i.loli.net/2021/02/21/xhudqnIY4UZGz52.png" width="100"/> 

  云函数端  
  做一个简短解释，具体可以看代码。  
- 由于小程序端页面比较多，对接的接口也特别多，如若每个接口都用一个云函数来写是很不切实际，而云函数创建最多只能50个，因此在实际开发中可以采用router来进行管理开发，这里就使用了tcb-router，用起来十分方便，有了router来进行管理，就可以把类似的接口一并写在一个云函数中，当要请求哪个接口就可以用路由来指定相应的接口处理函数即可，而发起请求，这里用了request和request-promise第三方包依赖来发起请求，总体来说可以把云函数理解成后端代码，通过云函数可以操作云数据库、云存储等

用于页面较多，实现方法跟思路一个个字仔细敲出来比较繁琐，影响阅读。具体可以看代码，在这里就做个简短的介绍。



